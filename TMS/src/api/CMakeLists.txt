
LINK_DIRECTORIES(
 ${VISHNU_EXCEPTION_INCLUDE_DIR}
)

INCLUDE_DIRECTORIES(
  .
  ${DIET_INCLUDE_DIR}
  ${EMF_DATA_DIR}
  ${UMS_DATA_DIR}
  ${TMS_EMF_DATA_DIR}
  ${TMS_DATA_DIR}
  ${EMF4CPP_INCLUDE_DIR}
  ${VISHNU_EXCEPTION_INCLUDE_DIR}
  ${CLIENT_PROXY_SOURCE_DIR}
  ${TMS_CLIENT_PROXY_SOURCE_DIR}
  ${UTILVISHNU_SOURCE_DIR}
  ${Boost_INCLUDE_DIRS}

)

ADD_LIBRARY(
vishnu-tms-api api_tms.cpp
)
SET_TARGET_PROPERTIES(vishnu-tms-api PROPERTIES COMPILE_FLAGS "-fPIC")

TARGET_LINK_LIBRARIES(vishnu-tms-api
  ${DIET_CLIENT_LIBRARIES}
  ${Boost_LIBRARIES}
  emf4cpp-UMS_Data
  exception-vishnu
  ums-client-proxy
  tms-client-proxy
  utils-vishnu
)

# Java and/or python are options
if (ENABLE_PYTHON OR ENABLE_JAVA)

# Requirements for PYTHON
FIND_PACKAGE(SWIG 1.3.40 REQUIRED)
INCLUDE(${SWIG_USE_FILE})
MARK_AS_ADVANCED(SWIG_DIR)
MARK_AS_ADVANCED(SWIG_EXECUTABLE)
MARK_AS_ADVANCED(SWIG_VERSION)

if(ENABLE_PYTHON)
FIND_PACKAGE(PythonLibs REQUIRED)
INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})
endif(ENABLE_PYTHON)

# Requirements for JAVA
if(ENABLE_JAVA)
FIND_PACKAGE(Java REQUIRED)
FIND_PATH(JAVA_INCLUDE_DIR jni.h
  $ENV{JAVA_HOME}/include
  /usr/lib/jvm/java/include
  /usr/lib/jvm/java-6*/include
  /usr/lib/jvm/java-6-sun-1.6.0.22/include
)
INCLUDE_DIRECTORIES(
  ${JAVA_INCLUDE_DIR}
  ${JAVA_INCLUDE_DIR}/linux
)
endif(ENABLE_JAVA)

# General SWIG configuration
SET_SOURCE_FILES_PROPERTIES(api_tms.i PROPERTIES CPLUSPLUS ON)
#Install swig language-specific generated files in a dedicated directory
SET (CMAKE_SWIG_OUTDIR ${CMAKE_CURRENT_BINARY_DIR}/swig_output)
file(MAKE_DIRECTORY ${CMAKE_SWIG_OUTDIR})
#Suppress warnings about ignored operators (out_ptr::operator= and EList::operator[])
SET(CMAKE_SWIG_FLAGS "-w362,389")

## PYTHON MODULE
#The module name must match the %module declaration in the interface file
if(ENABLE_PYTHON)
SWIG_ADD_MODULE(VISHNU_UMS python api_tms.i api_tms.cpp)
SET_TARGET_PROPERTIES(${SWIG_MODULE_VISHNU_UMS_REAL_NAME} PROPERTIES COMPILE_FLAGS "-fPIC")
SWIG_LINK_LIBRARIES(VISHNU_UMS ${PYTHON_LIBRARIES} ${DIET_CLIENT_LIB} vishnu-tms-api exception-vishnu)
INSTALL( TARGETS ${SWIG_MODULE_VISHNU_UMS_REAL_NAME} DESTINATION lib )
endif(ENABLE_PYTHON)

## JAVA MODULE
if(ENABLE_JAVA)
SET(CMAKE_SWIG_FLAGS "-w503" "-package" "com.sysfera.vishnu.api.tms.internal")
SWIG_ADD_MODULE(VISHNU_UMS java api_tms.i api_tms.cpp)
SET_TARGET_PROPERTIES(${SWIG_MODULE_VISHNU_UMS_REAL_NAME} PROPERTIES COMPILE_FLAGS "-fPIC")

SWIG_LINK_LIBRARIES(VISHNU_UMS ${JAVA_LIBRARIES} ${DIET_CLIENT_LIB} vishnu-tms-api exception-vishnu)
INSTALL( TARGETS ${SWIG_MODULE_VISHNU_UMS_REAL_NAME} DESTINATION lib )
endif(ENABLE_JAVA)


INSTALL( TARGETS vishnu-tms-api DESTINATION lib )
INSTALL( DIRECTORY ${CMAKE_SWIG_OUTDIR} DESTINATION lib)
endif(ENABLE_PYTHON OR ENABLE_JAVA)
INSTALL( FILES api_tms.hpp DESTINATION include)

